/* BetterUI - One Dark Theme for Twitter/X */

/* ========================================
   CURSOR HIDING - Shows only on movement
   ======================================== */

body.betterui-hide-cursor,
body.betterui-hide-cursor * {
  cursor: none !important;
}

body.betterui-hide-cursor a,
body.betterui-hide-cursor button,
body.betterui-hide-cursor [role="button"],
body.betterui-hide-cursor input,
body.betterui-hide-cursor textarea,
body.betterui-hide-cursor [contenteditable="true"] {
  cursor: none !important;
}

:root {
  --bg-primary: #282c34;
  --bg-secondary: #21252b;
  --bg-tertiary: #2c313a;
  --bg-hover: #3e4451;
  --text-primary: #abb2bf;
  --text-secondary: #5c6370;
  --text-muted: #4b5263;
  --accent-blue: #61afef;
  --accent-green: #98c379;
  --accent-red: #e06c75;
  --accent-yellow: #e5c07b;
  --accent-purple: #c678dd;
  --accent-cyan: #56b6c2;
  --border-color: #3e4451;
  --focus-ring: #61afef;
}

/* ========================================
   GLOBAL RESETS & BASE STYLES
   ======================================== */

body {
  background-color: var(--bg-primary) !important;
  font-size: 14px !important;
}

/* ========================================
   HIDE SIDEBARS
   ======================================== */

/* Left sidebar - navigation */
header[role="banner"],
[data-testid="sidebarColumn"],
[aria-label="Primary navigation"],
nav[aria-label="Primary navigation"] {
  display: none !important;
}

/* Right sidebar - trends, who to follow */
aside[aria-label="Who to follow"],
aside[aria-label="Trending"],
[aria-label="Search and explore"],
[aria-label="Timeline: Trending now"] {
  display: none !important;
}

/* Hide in-feed "Who to follow" suggestions */
main[role="main"]:not(#layers main[role="main"]) [data-testid="primaryColumn"] [data-testid="cellInnerDiv"]:has([data-testid="UserCell"]):not(:has(article[data-testid="tweet"])),
main[role="main"]:not(#layers main[role="main"]) [data-testid="primaryColumn"] [data-testid="cellInnerDiv"]:has(h2:is(:lang(en))[role="heading"]),
main[role="main"]:not(#layers main[role="main"]) [data-testid="primaryColumn"] [data-testid="cellInnerDiv"]:has(span:is(:lang(en))):not(:has(article)):not(:has([data-testid="tweetText"])) {
  display: none !important;
}

/* Hide "Who to follow" heading and its container in timeline */
main[role="main"]:not(#layers main[role="main"]) [data-testid="primaryColumn"] section [role="heading"]:has(span),
main[role="main"]:not(#layers main[role="main"]) [data-testid="primaryColumn"] [data-testid="cellInnerDiv"]:has(> div > div > [role="heading"]) {
  display: none !important;
}

/* Hide UserCell rows that appear in timeline (follow suggestions) */
main[role="main"]:not(#layers main[role="main"]) [data-testid="primaryColumn"] [data-testid="UserCell"]:not([aria-label*="Profile"]) {
  display: none !important;
}

/* Hide the Grok floating button */
[data-testid="grok-button"],
[aria-label="Grok"],
[data-testid="GrokDrawer"],
a[href="/i/grok"] {
  display: none !important;
}

/* Hide Messages floating button - be specific to avoid hiding video controls */
[data-testid="DMDrawer"],
aside[aria-label="Messages"],
nav [aria-label="Messages"],
header [aria-label="Messages"],
a[href="/messages"]:not(#layers a),
div[data-testid="DMDrawer"] {
  display: none !important;
}

/* Hide floating action buttons in bottom right - but not video overlays */
aside[aria-label="Messages"],
body > div[style*="position: fixed"][style*="bottom"] > a[href="/messages"],
body > div[style*="position: fixed"][style*="bottom"] > a[href="/i/grok"] {
  display: none !important;
}

/* Hide floating DM/Messages compose button (FAB) and chat drawer */
[data-testid="DM_Fab"],
[data-testid="DMFab"],
[data-testid="chat-drawer-root"],
[data-testid="chat-drawer-main"],
a[aria-label="Direct message"],
a[aria-label="New message"],
a[aria-label="Messages"][href="/messages"] {
  display: none !important;
  visibility: hidden !important;
}

/* Hide the entire chat drawer floating container */
div:has(> [data-testid="chat-drawer-root"]),
div:has(> div > [data-testid="chat-drawer-root"]) {
  display: none !important;
}

/* Target fixed/absolute positioned message containers */
div[style*="position: absolute"][style*="bottom"] a[href="/messages"],
div[style*="position: fixed"] a[href="/messages"] {
  display: none !important;
}

/* Hide message button when it's a direct child link to /messages */
a[href="/messages"]:not(#layers a):not([data-testid="AppTabBar_DirectMessage_Link"]) {
  display: none !important;
}

/* Hide premium upsells */
[data-testid="premium-signup-prompt"],
[href="/i/premium_sign_up"],
[href="/i/verified-choose"] {
  display: none !important;
}

/* Hide compose box at top of feed */
main[role="main"]:not(#layers main[role="main"]) [data-testid="primaryColumn"] > div > div:nth-child(2) [data-testid="tweetTextarea_0"],
main[role="main"]:not(#layers main[role="main"]) [data-testid="primaryColumn"] > div > div:nth-child(2) [data-testid="tweetTextarea_0_label"],
main[role="main"]:not(#layers main[role="main"]) [data-testid="primaryColumn"] [data-testid="tweetButtonInline"] {
  display: none !important;
}

/* Hide the entire compose section at top */
main[role="main"]:not(#layers main[role="main"]) div[data-testid="primaryColumn"] > div > div > div:has([data-testid="tweetTextarea_0"]) {
  display: none !important;
}

/* ========================================
   MAIN CONTENT CONTAINER - 666px CENTERED
   ======================================== */

/* Force the entire main area to be full width and centered */
main[role="main"]:not(#layers main[role="main"]) {
  width: 100% !important;
  max-width: 100% !important;
  margin: 0 auto !important;
  display: flex !important;
  justify-content: center !important;
}

/* Override Twitter's layout wrappers */
main[role="main"]:not(#layers main[role="main"]) > div {
  width: 100% !important;
  max-width: 100% !important;
  display: flex !important;
  justify-content: center !important;
}

main[role="main"]:not(#layers main[role="main"]) > div > div {
  width: 100% !important;
  max-width: 100% !important;
  display: flex !important;
  justify-content: center !important;
}

/* The primary column - perfectly centered (but NOT in lightbox/layers) */
main[role="main"]:not(#layers main[role="main"]) [data-testid="primaryColumn"] {
  width: 666px !important;
  max-width: 666px !important;
  min-width: 666px !important;
  margin: 0 auto !important;
  border-left: 1px solid var(--border-color) !important;
  border-right: 1px solid var(--border-color) !important;
  flex-shrink: 0 !important;
}

/* Reset primaryColumn in lightbox - let Twitter handle it */
#layers [data-testid="primaryColumn"] {
  width: auto !important;
  max-width: none !important;
  min-width: 0 !important;
  border: none !important;
}


/* ========================================
   ONE DARK THEME COLORS
   ======================================== */

/* Background colors */
main[role="main"]:not(#layers main[role="main"]) [data-testid="primaryColumn"],
[data-testid="cellInnerDiv"]:not(#layers *),
article[data-testid="tweet"]:not(#layers *),
div[data-testid="tweetDetail"]:not(#layers *) {
  background-color: var(--bg-primary) !important;
}

/* Tweet hover state */
article[data-testid="tweet"]:hover {
  background-color: var(--bg-secondary) !important;
}

/* Text colors */
[data-testid="tweetText"],
[data-testid="tweetText"] span {
  color: var(--text-primary) !important;
  font-size: 14px !important;
  line-height: 1.5 !important;
}

/* Username and handles */
[data-testid="User-Name"],
[data-testid="User-Name"] span {
  color: var(--text-primary) !important;
}

[data-testid="User-Name"] a[tabindex="-1"] span {
  color: var(--text-secondary) !important;
}

/* Timestamps */
time {
  color: var(--text-secondary) !important;
}

/* Links */
a[href*="/status/"] {
  color: var(--accent-blue) !important;
}

/* Hashtags and mentions */
a[href*="/hashtag/"],
a[href^="/"] {
  color: var(--accent-cyan) !important;
}

/* ========================================
   HIDE TOP BAR (For You / Following tabs)
   ======================================== */


/* Hide tab navigation in primary column (Posts/Replies/Media tabs) */
/* Timeline only (never touch #layers/lightbox) */
main[role="main"]:not(#layers main[role="main"]) [data-testid="primaryColumn"] > div > div > div > [role="tablist"],
main[role="main"]:not(#layers main[role="main"]) [data-testid="primaryColumn"] > div > div > [role="tablist"] {
  display: none !important;
}

/* Hide the "Home" title header */
main[role="main"]:not(#layers main[role="main"]) [data-testid="titleContainer"] {
  display: none !important;
}

/* Hide entire top sticky bar universally in primary column */
main[role="main"]:not(#layers main[role="main"]) [data-testid="primaryColumn"] > div > div:first-child {
  display: none !important;
}

/* Remove top padding that was for the header */
main[role="main"]:not(#layers main[role="main"]) [data-testid="primaryColumn"] > div > div:nth-child(2) {
  padding-top: 0 !important;
}

/* ========================================
   TWEET ACTIONS
   ======================================== */

/* Action buttons (reply, retweet, like, etc) */
[data-testid="reply"],
[data-testid="retweet"],
[data-testid="like"],
[data-testid="bookmark"],
[role="group"] svg {
  color: var(--text-secondary) !important;
}

[data-testid="reply"]:hover svg,
[data-testid="retweet"]:hover svg {
  color: var(--accent-green) !important;
}

[data-testid="like"]:hover svg {
  color: var(--accent-red) !important;
}

[data-testid="bookmark"]:hover svg {
  color: var(--accent-yellow) !important;
}

/* Already liked */
[data-testid="unlike"] svg {
  color: var(--accent-red) !important;
}

/* Already retweeted */
[data-testid="unretweet"] svg {
  color: var(--accent-green) !important;
}

/* ========================================
   COMPOSE TWEET - Custom Themed
   ======================================== */

/* Compose modal/dialog */
[data-testid="tweetTextarea_0"],
[data-testid="tweetTextarea_0_label"] {
  background-color: var(--bg-secondary) !important;
  color: var(--text-primary) !important;
}

/* The compose area wrapper */
[data-testid="tweetTextarea_0RichTextInputContainer"] {
  background-color: var(--bg-secondary) !important;
  border: 1px solid var(--border-color) !important;
  border-radius: 8px !important;
  padding: 12px !important;
}

/* Placeholder text */
[data-testid="tweetTextarea_0"][data-placeholder]::before,
.public-DraftEditorPlaceholder-root {
  color: var(--text-muted) !important;
}

/* Compose toolbar */
[data-testid="toolBar"] {
  background-color: var(--bg-secondary) !important;
  border-top: 1px solid var(--border-color) !important;
}

/* Toolbar icons */
[data-testid="toolBar"] svg {
  color: var(--accent-blue) !important;
}

/* Tweet button */
[data-testid="tweetButton"],
[data-testid="tweetButtonInline"] {
  background-color: var(--accent-blue) !important;
  border: none !important;
  font-weight: 600 !important;
}

[data-testid="tweetButton"]:hover,
[data-testid="tweetButtonInline"]:hover {
  background-color: #4a9fe0 !important;
}

/* Compose modal backdrop */
#layers [aria-labelledby="modal-header"]:has([data-testid="tweetTextarea_0"]) > div:first-child {
  background-color: rgba(0, 0, 0, 0.7) !important;
}

/* Compose modal container */
#layers [aria-labelledby="modal-header"]:has([data-testid="tweetTextarea_0"]) [data-testid="toolBar"],
#layers [aria-labelledby="modal-header"]:has([data-testid="tweetTextarea_0"]) > div > div > div {
  background-color: var(--bg-secondary) !important;
}

/* Character count */
[data-testid="tweetButtonInline"] ~ div,
[role="progressbar"] {
  color: var(--text-muted) !important;
}

/* ========================================
   MEDIA & CARDS
   ======================================== */

/* Image cards - only in feed/timeline, NOT in lightbox */
main[role="main"]:not(#layers main[role="main"]) [data-testid="primaryColumn"] [data-testid="tweetPhoto"] {
  border-radius: 8px !important;
  overflow: visible !important;
}

/* Ensure tweet images maintain aspect ratio and fit properly - feed only */
main[role="main"]:not(#layers main[role="main"]) [data-testid="primaryColumn"] article[data-testid="tweet"] [data-testid="tweetPhoto"] img {
  width: 100% !important;
  height: auto !important;
  max-height: none !important;
  object-fit: contain !important;
  border-radius: 8px !important;
}

/* Tweet media container - allow full display - feed only */
main[role="main"]:not(#layers main[role="main"]) [data-testid="primaryColumn"] article[data-testid="tweet"] [aria-label*="Image"],
main[role="main"]:not(#layers main[role="main"]) [data-testid="primaryColumn"] article[data-testid="tweet"] div:has(> [data-testid="tweetPhoto"]) {
  width: 100% !important;
  max-height: none !important;
  overflow: visible !important;
}

/* Fix for multi-image grids - feed only */
main[role="main"]:not(#layers main[role="main"]) [data-testid="primaryColumn"] article[data-testid="tweet"] [data-testid="tweetPhoto"] > div {
  max-height: none !important;
  overflow: visible !important;
}

/* Link cards */
[data-testid="card.wrapper"] {
  background-color: var(--bg-secondary) !important;
  border: 1px solid var(--border-color) !important;
  border-radius: 8px !important;
}

/* ========================================
   VIDEO PLAYER - ENSURE VISIBILITY
   ======================================== */

/* Make sure video players are always visible */
[data-testid="videoPlayer"],
[data-testid="videoComponent"],
[data-testid="previewInterstitial"],
[data-testid="placementTracking"] video,
video,
[data-testid="tweetPhoto"] video,
[data-testid="videoPlayer"] video {
  display: block !important;
  visibility: visible !important;
  opacity: 1 !important;
}

/* Video container should maintain proper dimensions */
[data-testid="videoPlayer"] {
  min-height: 100px !important;
}

/* Video player parent containers - ensure they're visible */
[data-testid="videoPlayer"] *,
[data-testid="videoComponent"] *,
div:has(> video),
div:has(> [data-testid="videoPlayer"]) {
  visibility: visible !important;
}

/* Media grid items (for profile Media tab) */
[data-testid="cellInnerDiv"] [role="link"][href*="/photo/"],
[data-testid="cellInnerDiv"] [role="link"][href*="/video/"],
[data-testid="UserProfileTimeline"] video,
[data-testid="UserProfileTimeline"] [data-testid="videoPlayer"],
section[role="region"] video,
section[role="region"] [data-testid="videoPlayer"] {
  display: block !important;
  visibility: visible !important;
}

/* ========================================
   PROFILE PAGE VIDEO FIX
   ======================================== */

/* Ensure videos in tweet articles are visible on profile pages */
article[data-testid="tweet"] [data-testid="videoPlayer"],
article[data-testid="tweet"] [data-testid="videoComponent"],
article[data-testid="tweet"] video,
article[data-testid="tweet"] [data-testid="tweetPhoto"] video {
  display: block !important;
  visibility: visible !important;
  opacity: 1 !important;
  max-height: none !important;
}

/* Video container wrapper in tweets - ensure it's visible */
article[data-testid="tweet"] [data-testid="videoPlayer"] > div,
article[data-testid="tweet"] [data-testid="videoComponent"] > div,
article[data-testid="tweet"] div:has(> video) {
  display: block !important;
  visibility: visible !important;
  opacity: 1 !important;
}

/* The media container in tweets that holds video */
article[data-testid="tweet"] [aria-label*="Embedded video"],
article[data-testid="tweet"] [aria-label*="embedded video"],
article[data-testid="tweet"] div[data-testid="tweetPhoto"]:has(video) {
  display: block !important;
  visibility: visible !important;
  opacity: 1 !important;
}

/* Ancestors of video players in tweets - make sure none are hidden */
article[data-testid="tweet"] *:has([data-testid="videoPlayer"]),
article[data-testid="tweet"] *:has([data-testid="videoComponent"]),
article[data-testid="tweet"] *:has(video) {
  visibility: visible !important;
}

/* Profile timeline specific - ensure video containers have proper display */
main[role="main"]:not(#layers main[role="main"]) [data-testid="primaryColumn"] article [data-testid="videoPlayer"],
main[role="main"]:not(#layers main[role="main"]) [data-testid="primaryColumn"] article video {
  display: block !important;
  visibility: visible !important;
  opacity: 1 !important;
  width: 100% !important;
  height: auto !important;
}


/* ========================================
   SCROLLBAR
   ======================================== */

::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: var(--bg-primary);
}

::-webkit-scrollbar-thumb {
  background: var(--bg-hover);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: var(--text-secondary);
}

/* ========================================
   VIM FOCUS INDICATOR
   ======================================== */

/* Enable transitions on all tweets for smooth focus changes */
article[data-testid="tweet"] {
  transition: outline 0.2s ease-out, 
              background-color 0.2s ease-out,
              outline-offset 0.15s ease-out !important;
  outline: 2px solid transparent;
  outline-offset: -2px;
}

.betterui-focused {
  outline: 2px solid var(--focus-ring) !important;
  outline-offset: -2px;
  background-color: var(--bg-tertiary) !important;
}

/* Focus ring for profile Media grid items (thumbnails) */
.betterui-media-focused {
  outline: 2px solid var(--focus-ring) !important;
  outline-offset: -2px;
  border-radius: 10px !important;
  position: relative !important;
  z-index: 5 !important;
}

.betterui-media-focused img,
.betterui-media-focused video {
  border-radius: 10px !important;
}

/* ========================================
   BETTERUI STATS WIDGET
   ======================================== */

#betterui-stats {
  position: fixed;
  top: 16px;
  left: 16px;
  background-color: var(--bg-secondary);
  border: 1px solid var(--border-color);
  border-radius: 6px;
  padding: 10px 14px;
  font-family: 'JetBrains Mono', 'Fira Code', 'SF Mono', monospace;
  font-size: 11px;
  color: var(--text-secondary);
  z-index: 9999;
  line-height: 1.8;
}

#betterui-stats .stat-row {
  display: flex;
  align-items: center;
  gap: 10px;
}

#betterui-stats .stat-label {
  color: var(--text-muted);
  min-width: 24px;
}

#betterui-stats .stat-value {
  color: var(--text-primary);
  font-weight: 500;
  min-width: 50px;
}

#betterui-stats .stat-tweets {
  color: var(--text-secondary);
  font-size: 10px;
}

#betterui-stats .stat-value.good {
  color: var(--accent-green);
}

#betterui-stats .stat-value.warning {
  color: var(--accent-yellow);
}

#betterui-stats .stat-value.bad {
  color: var(--accent-red);
}

/* ========================================
   LEADER KEY INDICATOR
   ======================================== */

#betterui-leader {
  position: fixed;
  bottom: 50%;
  left: 50%;
  transform: translate(-50%, 50%);
  background-color: var(--bg-secondary);
  border: 2px solid var(--accent-purple);
  border-radius: 8px;
  padding: 12px 20px;
  font-family: 'JetBrains Mono', 'Fira Code', 'SF Mono', monospace;
  font-size: 18px;
  color: var(--accent-purple);
  z-index: 10000;
  display: none;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
}

#betterui-leader.active {
  display: block;
}

#betterui-leader .keys {
  color: var(--text-primary);
  font-weight: bold;
}

/* ========================================
   HIDE ADS / PROMOTED TWEETS
   ======================================== */

/* ONLY hide cells explicitly marked as ads by JavaScript */
/* This is the ONLY ad-hiding rule - JS does the detection */
[data-testid="cellInnerDiv"][data-betterui-ad="true"] {
  display: none !important;
}

/* Ensure non-ad cells with videos are ALWAYS visible (outside lightbox) */
[data-testid="cellInnerDiv"]:not([data-betterui-ad="true"]):not(#layers *) {
  display: block !important;
}

[data-testid="cellInnerDiv"]:not([data-betterui-ad="true"]) video,
[data-testid="cellInnerDiv"]:not([data-betterui-ad="true"]) [data-testid="videoPlayer"],
[data-testid="cellInnerDiv"]:not([data-betterui-ad="true"]) [data-testid="videoComponent"] {
  display: block !important;
  visibility: visible !important;
  opacity: 1 !important;
}

/* ========================================
   HIDE MISC CLUTTER
   ======================================== */

/* Footer */
nav[aria-label="Footer"] {
  display: none !important;
}

/* Hide Twitter's native bottom navigation bar (mobile/narrow viewports) */
nav[aria-label="Bottom navigation"],
[data-testid="BottomBar"],
div[data-testid="primaryColumn"] ~ nav,
[role="navigation"][aria-label="Primary"],
nav[role="navigation"]:not([aria-label="Primary navigation"]) {
  display: none !important;
}

/* "What's happening" placeholder when empty */
[data-testid="emptyState"] {
  color: var(--text-secondary) !important;
}

/* ========================================
   AUTO-EXPAND TWEETS
   ======================================== */

/* Hide "Show more" button - multiple selector variants */
[data-testid="tweet-text-show-more-link"],
article[data-testid="tweet"] [role="button"][tabindex="0"]:has(span:only-child),
article span[role="button"]:not([data-testid]):not([aria-label]) {
  display: none !important;
}

/* Target Twitter's "Show more" link text directly */
article[data-testid="tweet"] span:not([data-testid]):not([class]) {
  /* Check if it contains "Show more" - handled by hiding the button above */
}

/* Force tweet text to show fully - remove all clipping */
[data-testid="tweetText"],
[data-testid="tweetText"] > span,
[data-testid="tweetText"] > div {
  max-height: none !important;
  -webkit-line-clamp: unset !important;
  -webkit-box-orient: unset !important;
  overflow: visible !important;
  display: block !important;
  text-overflow: unset !important;
}

/* Remove gradient fade that indicates truncation */
[data-testid="tweetText"]::after,
[data-testid="tweetText"] > span::after {
  display: none !important;
  background: none !important;
}

/* ========================================
   HIDE THREE DOTS MENU
   ======================================== */

[data-testid="caret"] {
  display: none !important;
}

article[data-testid="tweet"] [aria-label="More"] {
  display: none !important;
}

/* ========================================
   HIDE SHARE, IMPRESSIONS, GROK ON TWEETS
   ======================================== */

/* Hide share button on tweets only */
article[data-testid="tweet"] [aria-label="Share post"] {
  display: none !important;
}

/* Hide impressions/views count */
article[data-testid="tweet"] a[href*="/analytics"] {
  display: none !important;
}

/* Hide Grok button on tweets */
article[data-testid="tweet"] [aria-label="Grok actions"] {
  display: none !important;
}

/* ========================================
   HIDE BLUE CHECKMARKS
   ======================================== */

/* Hide verified badge */
[data-testid="icon-verified"],
svg[aria-label="Verified account"],
[aria-label="Verified account"] {
  display: none !important;
}

/* Hide all verification badges */
[data-testid="User-Name"] svg[viewBox="0 0 22 22"],
[data-testid="User-Name"] svg[viewBox="0 0 24 24"] {
  display: none !important;
}

/* ========================================
   TWEET ACTION BUTTONS - Always visible
   ======================================== */

/* Keep action buttons always visible */
article[data-testid="tweet"] [role="group"] {
  opacity: 1 !important;
}

/* ========================================
   REMOVE NATIVE TWEET SEPARATORS
   ======================================== */

/* Remove all native dividers/separators */
[data-testid="cellInnerDiv"] > div[style*="border-bottom"] {
  border-bottom: none !important;
}

[data-testid="cellInnerDiv"] {
  border-bottom: none !important;
}

/* Remove any separator divs */
div[style*="border-bottom-color"],
div[style*="border-bottom: 1px"] {
  border-bottom: none !important;
}

/* Add subtle custom separator only between tweets */
article[data-testid="tweet"] {
  border-bottom: 1px solid var(--border-color) !important;
  margin-bottom: 0 !important;
}

/* ========================================
   TWEET DETAIL PAGE - CLEAN VIEW
   ======================================== */

/* Tweet detail page width - only for the main column, NOT in lightbox */
body.betterui-tweet-page main[role="main"]:not(#layers main[role="main"]) [data-testid="primaryColumn"] {
  width: 600px !important;
  max-width: 600px !important;
  min-width: 600px !important;
}

/* ========================================
   MEDIA LIGHTBOX / OVERLAY VIEW
   ======================================== */

/* 
 * CRITICAL: Do NOT apply any layout styles to #layers.
 * The image lightbox uses [data-testid="swipe-to-dismiss"].
 * Let Twitter handle the entire lightbox layout natively.
 */

/* Only override styles for the side panel tweet content, not the main image */
#layers [data-testid="swipe-to-dismiss"] article[data-testid="tweet"] [data-testid="tweetPhoto"] img {
  max-height: 50vh !important;
  object-fit: contain !important;
}

/* Profile media tab - ensure proper grid layout */
body.betterui-media-page main[role="main"]:not(#layers main[role="main"]) [data-testid="primaryColumn"] {
  width: 100% !important;
  max-width: 100% !important;
  min-width: unset !important;
}

/* Restore media grid header visibility on media pages */
body.betterui-media-page main[role="main"]:not(#layers main[role="main"]) [data-testid="primaryColumn"] > div > div:first-child {
  display: block !important;
}

/* Ensure media grid items display properly */
body.betterui-media-page main[role="main"]:not(#layers main[role="main"]) [data-testid="cellInnerDiv"] {
  display: block !important;
}

/* ========================================
   TWEET IMAGES IN FEED - PROPER DISPLAY
   ======================================== */

/* Ensure tweet cell containers don't clip media */
[data-testid="cellInnerDiv"] article[data-testid="tweet"] {
  overflow: visible !important;
}

/* Media container within tweets */
article[data-testid="tweet"] > div > div > div:has([data-testid="tweetPhoto"]) {
  overflow: visible !important;
  max-height: none !important;
}

/* Quote tweets with images */
article[data-testid="tweet"] [data-testid="quoteTweet"] [data-testid="tweetPhoto"] {
  max-height: none !important;
  overflow: visible !important;
}

article[data-testid="tweet"] [data-testid="quoteTweet"] [data-testid="tweetPhoto"] img {
  width: 100% !important;
  height: auto !important;
  max-height: 300px !important;
  object-fit: contain !important;
}

/* Media grid container should use proper grid layout */
body.betterui-media-page main[role="main"]:not(#layers main[role="main"]) section[role="region"] > div > div {
  display: grid !important;
  grid-template-columns: repeat(3, 1fr) !important;
  gap: 4px !important;
}

/* Ensure media tab video thumbnails are visible */
main[role="main"]:not(#layers main[role="main"]) [data-testid="primaryColumn"] [href*="/video/"],
main[role="main"]:not(#layers main[role="main"]) [data-testid="primaryColumn"] [href*="/photo/"],
main[role="main"]:not(#layers main[role="main"]) [data-testid="primaryColumn"] a[href*="/status/"][href*="/video"],
main[role="main"]:not(#layers main[role="main"]) [data-testid="UserMedia"] video,
main[role="main"]:not(#layers main[role="main"]) [data-testid="UserMedia"] [data-testid="videoPlayer"],
main[role="main"]:not(#layers main[role="main"]) [data-testid="UserMedia"] [data-testid="tweetPhoto"],
main[role="main"]:not(#layers main[role="main"]) section[aria-labelledby*="media"] video,
main[role="main"]:not(#layers main[role="main"]) section[aria-labelledby*="media"] [data-testid="videoPlayer"] {
  display: block !important;
  visibility: visible !important;
  opacity: 1 !important;
}

/* Video thumbnails in grids */
main[role="main"]:not(#layers main[role="main"]) [data-testid="cellInnerDiv"] video,
main[role="main"]:not(#layers main[role="main"]) [data-testid="cellInnerDiv"] [data-testid="videoPlayer"],
main[role="main"]:not(#layers main[role="main"]) [data-testid="cellInnerDiv"] [data-testid="videoComponent"] {
  display: block !important;
  visibility: visible !important;
  opacity: 1 !important;
}

/* Tweet detail page - images should display properly with reasonable max */
body.betterui-tweet-page main[role="main"]:not(#layers main[role="main"]) [data-testid="tweetPhoto"] {
  max-height: none !important;
  width: 100% !important;
}

body.betterui-tweet-page main[role="main"]:not(#layers main[role="main"]) [data-testid="tweetPhoto"] img {
  max-height: 70vh !important;
  width: 100% !important;
  height: auto !important;
  object-fit: contain !important;
}

body.betterui-tweet-page main[role="main"]:not(#layers main[role="main"]) [data-testid="card.wrapper"] {
  max-height: none !important;
  overflow: visible !important;
}

/* Video constraints - remove restrictive sizing to allow natural dimensions */
body.betterui-tweet-page main[role="main"]:not(#layers main[role="main"]) article [data-testid="videoPlayer"],
body.betterui-tweet-page main[role="main"]:not(#layers main[role="main"]) article video {
  max-height: none !important;
  height: auto !important;
  width: 100% !important;
}

/* Ensure videos maintain aspect ratio */
video {
  max-height: 80vh !important;
  width: 100% !important;
  height: auto !important;
  object-fit: contain !important;
}

/* Clean padding */
body.betterui-tweet-page main[role="main"]:not(#layers main[role="main"]) article[data-testid="tweet"] {
  padding: 16px !important;
}

/* Hide reply box with avatar */
[data-testid="inline_reply_offscreen"] {
  display: none !important;
}

/* Hide Follow button in tweet detail */
body.betterui-tweet-page main[role="main"]:not(#layers main[role="main"]) [data-testid$="-follow"],
body.betterui-tweet-page main[role="main"]:not(#layers main[role="main"]) [data-testid$="-unfollow"] {
  display: none !important;
}

/* Hide Subscribe button */
[data-testid$="-subscribe"],
[data-testid="subscribeButton"],
[data-testid="unsubscribeButton"] {
  display: none !important;
}

/* ========================================
   BOOKMARKS PAGE - GRID LAYOUT
   ======================================== */

/* Grid container - injected by JS */
#betterui-bookmarks-grid {
  display: grid !important;
  grid-template-columns: repeat(5, 1fr) !important;
  gap: 12px !important;
  padding: 20px !important;
  width: 100vw !important;
  max-width: 100vw !important;
  box-sizing: border-box !important;
  margin-left: calc(-50vw + 50%) !important;
  padding-left: calc(50vw - 50% + 20px) !important;
  padding-right: calc(50vw - 50% + 20px) !important;
}

#betterui-bookmarks-grid .betterui-bookmark-card {
  background: var(--bg-secondary) !important;
  border: 1px solid var(--border-color) !important;
  border-radius: 8px !important;
  padding: 14px !important;
  height: 200px !important;
  overflow: hidden !important;
  cursor: pointer !important;
  transition: all 0.15s ease !important;
  display: flex !important;
  flex-direction: column !important;
}

#betterui-bookmarks-grid .betterui-bookmark-card:hover {
  background: var(--bg-tertiary) !important;
  border-color: var(--accent-blue) !important;
  transform: translateY(-2px) !important;
}

#betterui-bookmarks-grid .betterui-bookmark-card.focused {
  border-color: var(--focus-ring) !important;
  box-shadow: 0 0 0 2px var(--focus-ring) !important;
}

#betterui-bookmarks-grid .bookmark-header {
  display: flex !important;
  align-items: center !important;
  gap: 8px !important;
  margin-bottom: 8px !important;
  flex-shrink: 0 !important;
}

#betterui-bookmarks-grid .bookmark-avatar {
  width: 24px !important;
  height: 24px !important;
  border-radius: 50% !important;
  object-fit: cover !important;
}

#betterui-bookmarks-grid .bookmark-user {
  font-size: 12px !important;
  color: var(--text-primary) !important;
  font-weight: 500 !important;
  overflow: hidden !important;
  text-overflow: ellipsis !important;
  white-space: nowrap !important;
}

#betterui-bookmarks-grid .bookmark-time {
  font-size: 11px !important;
  color: var(--text-muted) !important;
  margin-left: auto !important;
}

#betterui-bookmarks-grid .bookmark-text {
  font-size: 13px !important;
  line-height: 1.4 !important;
  color: var(--text-primary) !important;
  overflow: hidden !important;
  flex-grow: 1 !important;
  display: -webkit-box !important;
  -webkit-line-clamp: 6 !important;
  -webkit-box-orient: vertical !important;
}

#betterui-bookmarks-grid .bookmark-media {
  margin-top: 8px !important;
  font-size: 10px !important;
  color: var(--accent-cyan) !important;
  flex-shrink: 0 !important;
}

/* Hide native timeline on bookmarks when grid is active */
body.betterui-bookmarks-page.betterui-grid-active main[role="main"]:not(#layers main[role="main"]) [data-testid="primaryColumn"] section {
  display: none !important;
}

body.betterui-bookmarks-page.betterui-grid-active main[role="main"]:not(#layers main[role="main"]) [data-testid="primaryColumn"] {
  width: 100% !important;
  max-width: 100% !important;
  min-width: unset !important;
  border: none !important;
}

/* Remove blue focus rings from Twitter's native styles */
*:focus {
  outline: none !important;
  box-shadow: none !important;
}

/* Only show our custom focus for tweets */
.betterui-focused:focus {
  outline: 2px solid var(--focus-ring) !important;
}

/* ========================================
   BETTERUI DIALOGS (Search & Compose)
   ======================================== */

/* Shared overlay styles */
.betterui-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.8);
  z-index: 10001;
  display: none;
  align-items: flex-start;
  justify-content: center;
  padding-top: 15vh;
}

.betterui-overlay.active {
  display: flex;
}

/* Shared dialog box */
.betterui-dialog {
  background: var(--bg-secondary);
  border: 2px solid var(--accent-blue);
  border-radius: 12px;
  padding: 0;
  width: 520px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.6);
  overflow: hidden;
}

/* Input field */
.betterui-dialog-input {
  width: 100%;
  padding: 18px 20px;
  background: transparent;
  border: none;
  color: var(--text-primary);
  font-size: 16px;
  font-family: inherit;
  outline: none;
  box-sizing: border-box;
}

.betterui-dialog-input::placeholder {
  color: var(--text-muted);
}

/* Textarea for compose */
.betterui-dialog-textarea {
  width: 100%;
  min-height: 120px;
  max-height: 300px;
  padding: 18px 20px;
  background: transparent;
  border: none;
  color: var(--text-primary);
  font-size: 16px;
  font-family: inherit;
  outline: none;
  resize: vertical;
  box-sizing: border-box;
  line-height: 1.5;
}

.betterui-dialog-textarea::placeholder {
  color: var(--text-muted);
}

/* Hint text */
.betterui-dialog-hint {
  padding: 10px 20px;
  font-size: 11px;
  color: var(--text-muted);
  border-top: 1px solid var(--border-color);
  font-family: 'JetBrains Mono', 'Fira Code', monospace;
}

/* Compose dialog specific */
.betterui-compose-dialog {
  border-color: var(--accent-purple);
}

.betterui-compose-footer {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px 20px;
  border-top: 1px solid var(--border-color);
}

.betterui-char-count {
  font-size: 13px;
  color: var(--text-secondary);
  font-family: 'JetBrains Mono', 'Fira Code', monospace;
}

.betterui-char-count.over {
  color: var(--accent-red);
}

.betterui-compose-button {
  background: var(--accent-purple);
  color: white;
  border: none;
  padding: 10px 24px;
  border-radius: 20px;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: background 0.15s ease;
}

.betterui-compose-button:hover {
  background: #b06cc8;
}

.betterui-compose-button:disabled {
  background: var(--bg-hover);
  color: var(--text-muted);
  cursor: not-allowed;
}

/* ========================================
   REPLY BOX MODAL - Minimal & Clean
   (Only target compose modal, NOT image lightbox)
   ======================================== */

/* Dark backdrop - only for compose modal, not lightbox */
#layers [aria-labelledby="modal-header"]:has([data-testid="tweetTextarea_0"]) {
  background: rgba(0, 0, 0, 0.85) !important;
}

/* Reset nested container backgrounds - compose modal only */
#layers [aria-labelledby="modal-header"]:has([data-testid="tweetTextarea_0"]) div {
  background-color: transparent !important;
  background: transparent !important;
}

/* The main modal container - apply our styling */
#layers [aria-labelledby="modal-header"]:has([data-testid="tweetTextarea_0"]) > div:last-child > div > div {
  background: var(--bg-secondary) !important;
  border: 2px solid var(--accent-purple) !important;
  border-radius: 12px !important;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.6) !important;
  max-width: 520px !important;
  overflow: hidden !important;
}

/* ===== HIDE ELEMENTS IN COMPOSE MODAL ONLY ===== */

/* Hide close button - compose modal only */
#layers [aria-labelledby="modal-header"]:has([data-testid="tweetTextarea_0"]) [aria-label="Close"] {
  display: none !important;
}

/* Hide Drafts - compose modal only */
#layers [aria-labelledby="modal-header"]:has([data-testid="tweetTextarea_0"]) [href="/compose/post/drafts"],
#layers [aria-labelledby="modal-header"]:has([data-testid="tweetTextarea_0"]) span:has(> a[href*="drafts"]) {
  display: none !important;
}

/* Hide the entire top row (Close + Drafts) */
#layers [aria-labelledby="modal-header"]:has([data-testid="tweetTextarea_0"]) > div:last-child > div > div > div:first-child {
  display: none !important;
}

/* Hide "Replying to @username" - compose modal only */
#layers [aria-labelledby="modal-header"]:has([data-testid="tweetTextarea_0"]) span:has(> a[role="link"][href^="/"]) {
  display: none !important;
}

/* Hide avatars in compose modal */
#layers [aria-labelledby="modal-header"]:has([data-testid="tweetTextarea_0"]) img[src*="profile"] {
  display: none !important;
}

#layers [aria-labelledby="modal-header"]:has([data-testid="tweetTextarea_0"]) [style*="width: 40px"],
#layers [aria-labelledby="modal-header"]:has([data-testid="tweetTextarea_0"]) [style*="width: 32px"] {
  width: 0 !important;
  min-width: 0 !important;
  overflow: hidden !important;
}

/* Hide thread connector */
#layers [aria-labelledby="modal-header"]:has([data-testid="tweetTextarea_0"]) [style*="border-left"] {
  border-left: none !important;
}

/* ===== TEXTAREA STYLING (compose modal only) ===== */

#layers [aria-labelledby="modal-header"]:has([data-testid="tweetTextarea_0"]) [data-testid="tweetTextarea_0RichTextInputContainer"] {
  background: transparent !important;
  border: none !important;
  padding: 20px !important;
  min-height: 120px !important;
}

#layers [aria-labelledby="modal-header"]:has([data-testid="tweetTextarea_0"]) [data-testid="tweetTextarea_0"],
#layers [aria-labelledby="modal-header"]:has([data-testid="tweetTextarea_0"]) [contenteditable="true"] {
  color: var(--text-primary) !important;
  font-size: 16px !important;
  line-height: 1.5 !important;
}

#layers [aria-labelledby="modal-header"]:has([data-testid="tweetTextarea_0"]) .public-DraftEditorPlaceholder-root {
  color: var(--text-muted) !important;
}

/* ===== TOOLBAR - HIDE ICONS, KEEP BUTTON (compose modal only) ===== */

/* Hide all toolbar buttons except Reply - compose modal only */
#layers [aria-labelledby="modal-header"]:has([data-testid="tweetTextarea_0"]) [data-testid="toolBar"] button:not([data-testid="tweetButton"]) {
  display: none !important;
}

/* Hide progress indicator - compose modal only */
#layers [aria-labelledby="modal-header"]:has([data-testid="tweetTextarea_0"]) [role="progressbar"],
#layers [aria-labelledby="modal-header"]:has([data-testid="tweetTextarea_0"]) [data-testid="toolBar"] [role="progressbar"] {
  display: none !important;
}

/* Hide the icon container div - compose modal only */
#layers [aria-labelledby="modal-header"]:has([data-testid="tweetTextarea_0"]) [data-testid="toolBar"] > div > div:first-child {
  display: none !important;
}

/* Style the toolbar - compose modal only */
#layers [aria-labelledby="modal-header"]:has([data-testid="tweetTextarea_0"]) [data-testid="toolBar"] {
  background: var(--bg-secondary) !important;
  border-top: 1px solid var(--border-color) !important;
  padding: 12px 20px !important;
  display: flex !important;
  justify-content: flex-end !important;
}

/* ===== REPLY BUTTON (compose modal only) ===== */

#layers [aria-labelledby="modal-header"]:has([data-testid="tweetTextarea_0"]) [data-testid="tweetButton"] {
  background: var(--accent-purple) !important;
  color: white !important;
  border: none !important;
  border-radius: 20px !important;
  font-size: 14px !important;
  font-weight: 600 !important;
  padding: 8px 20px !important;
  min-height: 36px !important;
  opacity: 1 !important;
}

#layers [aria-labelledby="modal-header"]:has([data-testid="tweetTextarea_0"]) [data-testid="tweetButton"] span {
  color: white !important;
}

#layers [aria-labelledby="modal-header"]:has([data-testid="tweetTextarea_0"]) [data-testid="tweetButton"]:hover {
  background: #b06cc8 !important;
}

#layers [aria-labelledby="modal-header"]:has([data-testid="tweetTextarea_0"]) [data-testid="tweetButton"][aria-disabled="true"] {
  background: var(--bg-hover) !important;
}

#layers [aria-labelledby="modal-header"]:has([data-testid="tweetTextarea_0"]) [data-testid="tweetButton"][aria-disabled="true"] span {
  color: var(--text-muted) !important;
}

/* ========================================
   HELP DIALOG
   ======================================== */

.betterui-help-dialog {
  background: var(--bg-secondary);
  border: 1px solid var(--border-color);
  border-radius: 12px;
  width: 500px;
  max-height: 80vh;
  overflow: hidden;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.6);
}

.betterui-help-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 16px 20px;
  border-bottom: 1px solid var(--border-color);
  font-size: 15px;
  font-weight: 600;
  color: var(--text-primary);
}

.betterui-help-close {
  font-size: 12px;
  color: var(--text-muted);
  font-weight: 400;
}

.betterui-help-content {
  padding: 16px 20px;
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 20px;
  max-height: 60vh;
  overflow-y: auto;
}

.betterui-help-section:last-child {
  grid-column: 1 / -1;
}

.betterui-help-title {
  font-size: 11px;
  font-weight: 600;
  color: var(--accent-purple);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin-bottom: 10px;
}

.betterui-help-row {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 8px;
  font-size: 13px;
  color: var(--text-primary);
}

.betterui-help-row span {
  color: var(--text-secondary);
  margin-left: auto;
}

.betterui-help-row kbd {
  background: var(--bg-tertiary);
  border: 1px solid var(--border-color);
  border-radius: 4px;
  padding: 3px 8px;
  font-family: 'JetBrains Mono', 'Fira Code', monospace;
  font-size: 11px;
  color: var(--text-primary);
  min-width: 20px;
  text-align: center;
}

/* ========================================
   PROFILE PAGE TABS (Replies, Media, Likes)
   ======================================== */

#betterui-profile-tabs {
  position: fixed;
  top: 50%;
  right: 20px;
  transform: translateY(-50%);
  display: flex;
  flex-direction: column;
  gap: 8px;
  z-index: 9999;
  background: var(--bg-secondary);
  border: 1px solid var(--border-color);
  border-radius: 8px;
  padding: 8px;
}

.betterui-profile-tab {
  background: transparent;
  border: 1px solid transparent;
  border-radius: 6px;
  padding: 10px 16px;
  color: var(--text-secondary);
  font-size: 13px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.15s ease;
  text-align: left;
  white-space: nowrap;
}

.betterui-profile-tab:hover {
  background: var(--bg-tertiary);
  color: var(--text-primary);
}

.betterui-profile-tab.active {
  background: var(--accent-blue);
  color: white;
  border-color: var(--accent-blue);
}

.betterui-profile-tab .tab-key {
  display: inline-block;
  background: var(--bg-tertiary);
  color: var(--text-muted);
  font-size: 10px;
  font-family: 'JetBrains Mono', 'Fira Code', monospace;
  padding: 2px 5px;
  border-radius: 3px;
  margin-right: 6px;
  min-width: 14px;
  text-align: center;
}

.betterui-profile-tab.active .tab-key {
  background: rgba(255, 255, 255, 0.2);
  color: white;
}

/* ========================================
   NOTIFICATIONS LIST VIEW
   ======================================== */

#betterui-notifications-list {
  width: 100%;
  padding: 12px;
  box-sizing: border-box;
}

.betterui-notif-header {
  display: grid;
  grid-template-columns: 180px 100px 1fr 80px;
  gap: 12px;
  padding: 12px 16px;
  background: var(--bg-tertiary);
  border-radius: 8px 8px 0 0;
  font-size: 11px;
  font-weight: 600;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  border-bottom: 1px solid var(--border-color);
}

.betterui-notif-row {
  display: grid;
  grid-template-columns: 180px 100px 1fr 80px;
  gap: 12px;
  padding: 12px 16px;
  background: var(--bg-secondary);
  border-bottom: 1px solid var(--border-color);
  align-items: center;
  transition: background 0.15s ease;
}

.betterui-notif-row:hover {
  background: var(--bg-tertiary);
}

.betterui-notif-row:last-child {
  border-radius: 0 0 8px 8px;
}

.betterui-notif-row .col-account {
  display: flex;
  align-items: center;
  gap: 8px;
  overflow: hidden;
}

.betterui-notif-row .notif-avatar {
  width: 28px;
  height: 28px;
  border-radius: 50%;
  object-fit: cover;
  flex-shrink: 0;
}

.betterui-notif-row .notif-username {
  color: var(--text-primary);
  font-size: 13px;
  font-weight: 500;
  text-decoration: none;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.betterui-notif-row .notif-username:hover {
  color: var(--accent-blue);
}

.betterui-notif-row .col-action {
  display: flex;
  align-items: center;
  gap: 6px;
}

.betterui-notif-row .action-icon {
  font-size: 14px;
}

.betterui-notif-row .action-text {
  font-size: 12px;
  color: var(--text-secondary);
  text-transform: capitalize;
}

.betterui-notif-row .col-link {
  overflow: hidden;
}

.betterui-notif-row .notif-content {
  color: var(--text-primary);
  font-size: 13px;
  text-decoration: none;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
  line-height: 1.4;
}

.betterui-notif-row .notif-content:hover {
  color: var(--accent-blue);
}

.betterui-notif-row .notif-content-empty {
  color: var(--text-muted);
}

.betterui-notif-row .col-date {
  font-size: 12px;
  color: var(--text-muted);
  text-align: right;
}

/* Hide native timeline on notifications when list is active */
body.betterui-notifications-page.betterui-notifications-active main[role="main"]:not(#layers main[role="main"]) [data-testid="primaryColumn"] section {
  display: none !important;
}

/* Show header on profile pages */
body.betterui-profile-page main[role="main"]:not(#layers main[role="main"]) [data-testid="primaryColumn"] > div > div:first-child {
  display: block !important;
}
